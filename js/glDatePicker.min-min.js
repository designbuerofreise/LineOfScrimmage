!function(){jQuery.fn.glDatePicker=function(e){var t=this.data("glDatePicker");return t?!0===e?t:this:this.each(function(){return jQuery(this).data("glDatePicker",new O(this,e))})},jQuery.fn.glDatePicker.defaults={cssName:"default",zIndex:1e3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!1,hideOnClick:!0,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"◄",nextArrow:"►",selectableDates:null,selectableDateRange:null,specialDates:null,selectableMonths:null,selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(e,t,a){e.val(a.toLocaleDateString())},onHover:function(){},onShow:function(e){e.show()},onHide:function(e){e.hide()},firstDate:null};var O=function(){function a(e,t){var a=this;a.el=jQuery(e);var n=a.el;a.options=jQuery.extend(!0,{},jQuery.fn.glDatePicker.defaults,t);var r=a.options;a.calendar=jQuery(jQuery.find("[gldp-el="+n.attr("gldp-id")+" ]")),r.selectedDate=r.selectedDate||r.todayDate,r.firstDate=new Date(r.firstDate||r.selectedDate)._first(),(n.attr("gldp-id")||"").length||n.attr("gldp-id","gldp-"+Math.round(1e10*Math.random())),n.addClass("gldp-el").bind("click",function(e){a.show(e)}).bind("focus",function(e){a.show(e)}),a.calendar.length&&!r.showAlways&&a.calendar.hide(),jQuery(document).bind("mouseup",function(e){var e=e.target,t=a.calendar;!n.is(e)&&!t.is(e)&&0===t.has(e).length&&t.is(":visible")&&a.hide()}),a.render()}return a.prototype={show:function(){jQuery.each(jQuery(".gldp-el").not(this.el),function(e,t){t.length&&t.options.onHide(t.calendar)}),this.options.onShow(this.calendar)},hide:function(){this.options&&!this.options.showAlways&&this.options.onHide(this.calendar)},render:function(a){var g=this,d=g.el,b=g.options,c=g.calendar,j="gldp-"+b.cssName,t=b.todayDate._val(),u=t.time,h=b.borderSize+"px",y=function(e,t,a){for(var n=[],r=e;t>=r;r++)n.push(r);if(a){var o=[];jQuery.each(a,function(a,n){n>=e&&t>=n&&0>o._indexOf(n)&&o.push(n)}),n=o.length?o:n}return n.sort(),n},H=y(0,11,b.selectableMonths),v=y(t.year-5,t.year+5,b.selectableYears),y=y(0,6,b.selectableDOW),z=b.dowNames||"Sun Mon Tue Wed Thu Fri Sat".split(" "),t=b.monthNames||"January February March April May June July August September October November December".split(" "),f=d.outerWidth(),e,k=f/7+6*(b.borderSize/7),f=f/8+7*(b.borderSize/8);c.length?eval(c.data("is"))||(f=c.outerWidth(),e=c.outerHeight(),k=f/7+6*(b.borderSize/7),f=e/8+7*(b.borderSize/8)):(g.calendar=c=jQuery("<div/>").attr("gldp-el",d.attr("gldp-id")).data("is",!0).css({display:b.showAlways?void 0:"none",zIndex:b.zIndex,width:7*k+"px"}),jQuery("body").append(c)),d.is(":visible")||c.hide(),c.removeClass().addClass(j).children().remove(),j=function(){var e=d.offset();c.css({top:e.top+d.outerHeight()+b.calendarOffset.y+"px",left:e.left+b.calendarOffset.x+"px"})},jQuery(window).resize(j),j();var j={width:k+"px",height:f+"px",lineHeight:f+"px"},f=function(e){for(var t=new Date(b.firstDate),e=e||0;t.setMonth(t.getMonth()+e),t.setDate(Math.min(1,t._max())),0!=e;){var a=t._val(),n=a.year;if(-1!=H._indexOf(a.month)){if(-1!=v._indexOf(n))break;if(n<v[0]||n>v[v.length-1])return null}}return t},A=f(-1),B=f(1),f=b.firstDate=f();e=f._val();var I=e.month,J=e.year,f=new Date(f);e=Math.abs(Math.min(6,Math.max(0,b.dowOffset)));var l=f.getDay()-e,l=1>l?-7-l:-l,z=z.concat(z).slice(e,e+7);for(f._add(l),e=jQuery("<div/>").addClass(" core border monyear ").css(jQuery.extend({},j,{borderWidth:h+" 0 0 "+h})).append(jQuery("<a/>").addClass("prev-arrow"+(A?"":"-off")).html(b.prevArrow)).mousedown(function(){return!1}).click(function(e){""!=b.prevArrow&&A&&(e.stopPropagation(),A&&(b.firstDate=A,g.render()))}),k=5*k-5*b.borderSize+b.borderSize,k=jQuery("<div/>").addClass(" core border monyear title").css(jQuery.extend({},j,{width:k+"px",borderTopWidth:h,marginLeft:"-"+h})),l=jQuery("<div/>").addClass(" core border monyear ").css(jQuery.extend({},j,{marginLeft:"-"+h,borderWidth:h+" "+h+" 0 0"})).append(jQuery("<a/>").addClass("next-arrow"+(B?"":"-off")).html(b.nextArrow)).mousedown(function(){return!1}).click(function(e){""!=b.nextArrow&&B&&(e.stopPropagation(),B&&(b.firstDate=B,g.render()))}),c.append(e).append(k).append(l),l=e=0;7>e;e++)for(var q=0;7>q;q++,l++){var C=new Date(f),n="day",r=b.zIndex+l,w=jQuery("<div/>");if(e){C._add(q+7*(e-1));var p=C._val(),x=p.time,K=null,s=!0,D=function(e,t){return!0===e.repeatYear&&t.setYear(p.year),!0===e.repeatMonth&&t.setMonth(p.month),t._val()};w.html(p.date),b.selectableDateRange&&(s=!1,jQuery.each(b.selectableDateRange,function(e,t){var a=t.from,n=t.to||null,n=n||new Date(t.from.getFullYear(),t.from.getMonth(),t.from._max()),a=D(t,a),n=D(t,n);return x>=a.time&&x<=n.time?s=!0:void 0})),b.selectableDates&&((b.selectableDateRange&&!s||s&&!b.selectableDateRange)&&(s=!1),jQuery.each(b.selectableDates,function(e,t){return D(t,t.date).time==x?s=!0:void 0})),!s||0>v._indexOf(p.year)||0>H._indexOf(p.month)||0>y._indexOf(p.day)?n="noday":(n="sun mon tue wed thu fri sat".split(" ")[p.day],I!=p.month&&(n+=" outday"),u==x&&(n="today",r+=50),b.selectedDate._time()==x&&(n="selected",r+=51),b.specialDates&&jQuery.each(b.specialDates,function(e,t){D(t,t.date).time==x&&(n=t.cssClass||"special",r+=52,K=t.data)}),w.mousedown(function(){return!1}).hover(function(e){e.stopPropagation(),e=jQuery(this).data("data"),b.onHover(d,w,e.date,e.data)}).click(function(e){e.stopPropagation(),e=jQuery(this).data("data"),b.selectedDate=b.firstDate=e.date,g.render(function(){!b.showAlways&&b.hideOnClick&&g.hide()}),b.onClick(d,jQuery(this),e.date,e.data)}))}else n="dow",w.html(z[q]),C=null;jQuery.extend(j,{borderTopWidth:h,borderBottomWidth:h,borderLeftWidth:e>0||!e&&!q?h:0,borderRightWidth:e>0||!e&&6==q?h:0,marginLeft:q>0?"-"+h:0,marginTop:e>0?"-"+h:0,zIndex:r}),w.data("data",{date:C,data:K}).addClass(" core border "+n).css(j),c.append(w)}var N=function(e){b.allowMonthSelect&&(L.css({display:e?"inline-block":"none"}),E.css({display:e?"none":"inline-block"})),b.allowYearSelect&&(M.css({display:e?"none":"inline-block"}),F.css({display:e?"inline-block":"none"}))},u=function(){b.firstDate=new Date(F.val(),E.val(),1),g.render()},E=jQuery("<select/>").hide().change(u),F=jQuery("<select/>").hide().change(u),L=jQuery("<span/>").html(t[I]).mousedown(function(){return!1}).click(function(e){e.stopPropagation(),N(!1)}),M=jQuery("<span/>").html(J).mousedown(function(){return!1}).click(function(e){e.stopPropagation(),N(!0)});jQuery.each(t,function(e,t){if(b.allowMonthSelect&&-1!=H._indexOf(e)){var a=jQuery("<option/>").html(t).attr("value",e);e==I&&a.attr("selected","selected"),E.append(a)}}),jQuery.each(v,function(e,t){if(b.allowYearSelect){var a=jQuery("<option/>").html(t).attr("value",t);t==J&&a.attr("selected","selected"),F.append(a)}}),u=jQuery("<div/>").append(L).append(E).append(M).append(F),k.children().remove(),k.append(u),(a||function(){})()}},a}();Date.prototype._clear=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype._time=function(){return this._clear().getTime()},Date.prototype._max=function(){return[31,28+(1==new Date(this.getYear(),1,29).getMonth()?1:0),31,30,31,30,31,31,30,31,30,31][this.getMonth()]},Date.prototype._add=function(e){this.setDate(this.getDate()+e)},Date.prototype._first=function(){var e=new Date(this);return e.setDate(1),e},Date.prototype._val=function(){return this._clear(),{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()}},Array.prototype._indexOf=function(e){return jQuery.inArray(e,this)}}();